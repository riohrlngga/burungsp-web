 <!DOCTYPE html>
More actions

  <html lang="id">

  <head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">





    <title>Dashboard Admin - BurungSP</title>

    <style>

      *{

  box-sizing: border-box;

}

      body {

        font-family: Arial, sans-serif;

        background: #111;

        color: #fff;

        margin: 0;

        padding: 20px;

      }

      h1 {

        color: #ff69b4;

      }

      table {

  width: 100%;

  max-width: 100%;

  border-collapse: collapse;

  margin-top: 20px;

  table-layout: fixed;

}





  th, td {

    border: 1px solid #555;

    padding: 10px;

    text-align: left;

    word-break: break-word;

  }





      th {

        background-color: #222;

      }

      button {

        background: #ff69b4;

        color: #fff;

        border: none;

        padding: 5px 10px;

        margin: 0 2px;

        cursor: pointer;

        border-radius: 4px;

      }

      input {

        padding: 6px;

        margin: 5px;

      }

      .login-container {

        display: flex;

        justify-content: center;

        align-items: center;

        height: 100vh;

        background: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.9)), url('logo.png') no-repeat center center;

        background-size: cover;

      }

      .login-box {

        background-color: rgba(0, 0, 0, 0.8);

        padding: 30px 25px;

        border-radius: 12px;

        width: 100%;

        max-width: 350px;

        box-shadow: 0 0 25px rgba(255, 255, 255, 0.2);

        color: white;

        text-align: center;

        opacity: 0;

        transform: translateY(20px);

        transition: all 0.6s ease;

      }

      .login-box.show {

        opacity: 1;

        transform: translateY(0);

        animation: fadein 0.6s ease;

      }

      .login-box input {

        width: 100%;

        padding: 12px 10px;

        margin: 12px 0;

        border: none;

        border-radius: 6px;

        background: #222;

        color: white;

        font-size: 1em;

      }

      .login-box button {

        width: 100%;

        padding: 12px;

        background: #2969ff;

        color: white;

        border: none;

        font-weight: bold;

        border-radius: 6px;

        cursor: pointer;

        font-size: 1em;

        transition: background 0.3s ease;

      }

      .login-box button:hover {

        background: #1e4ed8;

      }

      @keyframes fadein {

        from { opacity: 0; transform: scale(0.95); }

        to { opacity: 1; transform: scale(1); }

      }

      html, body {

        margin: 0;

        padding: 0;

        height: 100%;

      }

      .fullscreen-logo {

        position: fixed;

        top: 0;

        left: 0;

        width: 100vw;

        height: 100vh;

        background-color: #000;

        display: flex;

        justify-content: center;

        align-items: center;

        z-index: 9999;

        animation: fadeOut 1.5s ease 2s forwards;

      }

      .fullscreen-logo img {

        max-width: 200px;

        animation: logoZoom 1.2s ease;

      }

      @keyframes logoZoom {

        from { transform: scale(0.7); opacity: 0; }

        to { transform: scale(1); opacity: 1; }

      }

      @keyframes fadeOut {

        to { opacity: 0; visibility: hidden; }

      }

      #admin-box {

    position: absolute;

    top: 0;

    left: 0;

    width: 100%;

    padding: 20px;

    background-color: #111;

    z-index: 10;

    display: none; /* default disembunyikan */

  }





      .logout-btn {

        position: absolute;

        top: 20px;

        right: 20px;

        background-color: #ff69b4;

        color: #fff;

        border: none;

        padding: 10px 15px;

        border-radius: 6px;

        font-weight: bold;

        cursor: pointer;

        z-index: 10;

      }

      .logout-btn:hover {

        background-color: #ff1493;

      }

  /* Struktur produk (BERLAKU UNTUK SEMUA LAYAR) */

.produk-row {

  display: block; /* agar tinggi konten mengikuti isi, bukan flex */

}

.produk-grid-wrapper {

  display: block;

}



.produk-tabel-wrap {

  width: 100%;

  box-sizing: border-box;

  background-color: #111;

  border-radius: 8px;

  box-shadow: 0 0 10px #000;

  overflow-x: auto;

  margin-bottom: 20px;

}





.produk-tabel-wrap table {

  width: 100%;

  border-collapse: collapse;

  table-layout: fixed;

  font-size: 14px;

}



.produk-tabel-wrap th,

.produk-tabel-wrap td {

  border: 1px solid #555;

  padding: 8px;

  text-align: center;

  background-color: #111;

  color: #fff;

  word-break: break-word;

}





/* Responsive layout lain */

@media (max-width: 768px) {

  body {

    padding: 10px;

  }



  .login-box {

    padding: 20px 15px;

    max-width: 90%;

  }



  table, th, td {

    font-size: 14px;

  }



  input, button {

    width: 100%;

    margin: 8px 0;

    font-size: 1em;

  }



  .logout-btn {

    top: 10px;

    right: 10px;

    padding: 8px 12px;

    font-size: 14px;

  }



  h1 {

    font-size: 22px;

    text-align: center;

  }



  #admin-box input {

    margin-bottom: 10px;

  }

}



/* Responsive tambahan untuk layar sangat kecil */

@media (max-width: 480px) {

  h1 {

    font-size: 18px;

  }



  table, th, td {

    font-size: 12px;

  }



  .logout-btn {

    font-size: 12px;

    padding: 6px 10px;

  }



  input, button {

    font-size: 0.9em;

  }

}

.dashboard-flex {

  display: flex;

  flex-wrap: wrap;

  gap: 20px;

  margin-top: 30px;

}



.produk-kiri {

  flex: 1 1 50%;

  min-width: 400px;

  max-width: 100%;

  box-sizing: border-box;

  max-height: 85vh;

  overflow-y: auto;

}



.pesanan-kanan {

  flex: 1 1 50%;

  min-width: 400px;

  max-width: 100%;

  box-sizing: border-box;

  max-height: 85vh;

  overflow-y: auto;

}



/* Responsive HP */

@media (max-width: 768px) {

  .dashboard-flex {

    flex-direction: column;

  }

}

.dashboard-flex {

  align-items: flex-start;

}

select {
  padding: 6px;
  margin: 5px;
  border-radius: 4px;
  background-color: #222;
  color: #fff;
  border: none;
}




    </style>

  </head>

  <body>

    <div id="fullscreen-logo" class="fullscreen-logo">

      <img src="logo.png" alt="Logo BurungSP" />

    </div>



    <div id="login-box" class="login-container" style="display: none;">

<form onsubmit="login(event); return false;" class="login-box">

        <h2>Admin Login</h2>

        <input type="email" id="email" placeholder="Email" required />

        <input type="password" id="password" placeholder="Password" required />

        <button type="submit">Login</button>

      </form>

    </div>



  <div class="container">

    <div id="admin-box" style="display: none;">

      <button class="logout-btn" onclick="logout()">Logout</button>

      <h1>Dashboard Admin - BurungSP</h1>

      <div>

        <input type="text" id="nama" placeholder="Nama Produk">

        <input type="number" id="harga" placeholder="Harga">

        <input type="number" id="stok" placeholder="Stok">
       <select id="kategori">
  <option value="">-- Pilih Kategori --</option>
  <option value="üíß LIQUID FOOM ALL VARIAN">üíß LIQUID FOOM ALL VARIAN</option>
  <option value="üíß FREEBASE ALA CARTE">üíß FREEBASE ALA CARTE</option>
  <option value="üíß SALTNIC ICE PEDIA">üíß SALTNIC ICE PEDIA</option>
  <option value="üçìüçá LIQUID BUAQITA üçâüçç">üçìüçá LIQUID BUAQITA üçâüçç</option>
  <option value="Varian Gummy">Varian Gummy</option>
  <option value="Varian Salt Nic">Varian Salt Nic</option>
  <option value="üî• DEVICE FOOM">üî• DEVICE FOOM</option>
  <option value="üîÑ CATRIDGE">üîÑ CATRIDGE</option>
</select>

        <button onclick="tambahProduk()">Tambah Produk</button>

      </div>


      <div style="margin-top: 10px;">


  <input type="text" id="cari-produk" placeholder="üîç Cari produk..." oninput="filterProduk()" style="width:100%; padding:10px; font-size:16px;">


</div>




    <div style="overflow-x:auto;">

    <div class="dashboard-flex">

  <div class="produk-kiri">

    <div id="produk-grid-wrapper" class="produk-grid-wrapper"></div>

  </div>

  <div class="pesanan-kanan">

    <h2 style="color:#ff69b4;">üì¶ Riwayat Pesanan</h2>

    <div style="overflow-x:auto;">

      <table>

     <thead>
  <tr>
    <th>Kode</th>
    <th>Waktu</th>
    <th>Items</th>
    <th>Kategori</th>
    <th>Status</th>
    <th>Aksi</th>
    <th>Bukti</th>
  </tr>
</thead>

        <tbody id="tabel-pesanan"></tbody>

      </table>

    </div>

  </div>

</div>



  </div> <!-- penutup admin-box -->

  </div> <!-- penutup container -->





    <script>

      window.addEventListener('load', () => {

        setTimeout(() => {

          document.getElementById('fullscreen-logo').style.display = 'none';

          const loginBox = document.getElementById('login-box');

          loginBox.style.display = 'flex';

          setTimeout(() => {

            loginBox.querySelector('.login-box').classList.add('show');

          }, 50);

        }, 2000);

      });

    </script>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";

import {

  getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc, getDoc

} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";



import {

  getAuth,

  signInWithEmailAndPassword,

  onAuthStateChanged,

  signOut,

  setPersistence,

  browserSessionPersistence

} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";



// Firebase config

const firebaseConfig = {

  apiKey: "AIzaSyAxC2MTMzwOfj3KlpHYMkhyeFvqJmR5kSk",

  authDomain: "burungsp-69fdb.firebaseapp.com",

  projectId: "burungsp-69fdb",

  storageBucket: "burungsp-69fdb.firebasestorage.app",

  messagingSenderId: "743244451524",

  appId: "1:743244451524:web:c55f9871a8debfa6238391",

  measurementId: "G-LSYDF74Q16"

};



// Inisialisasi Firebase

const app = initializeApp(firebaseConfig);

const db = getFirestore(app);

const auth = getAuth(app);



// Jaga sesi tetap aktif selama tab terbuka

setPersistence(auth, browserSessionPersistence).then(() => {

  const loginBox = document.getElementById("login-box");

  const adminBox = document.getElementById("admin-box");



  onAuthStateChanged(auth, user => {

    if (user) {

      loginBox.style.display = "none";

      adminBox.style.display = "block";

      loadProduk();

      loadPesanan();

    } else {

      loginBox.style.display = "flex";

      adminBox.style.display = "none";

    }

  });

});



// ‚úÖ Fungsi Login global agar bisa dipanggil dari HTML

window.login = async function (event) {

  event.preventDefault(); // ‚õî supaya form tidak reload

  const email = document.getElementById("email").value;

  const password = document.getElementById("password").value;

  try {

    await signInWithEmailAndPassword(auth, email, password);

  } catch (err) {

    alert("Login gagal: " + err.message);

  }

};





// ‚úÖ Fungsi Logout global juga

window.logout = async function () {

  await signOut(auth);

};



// ------------------ PRODUK ----------------------

async function loadProduk() {

  const snapshot = await getDocs(collection(db, "produk"));

  const dataList = [];



  snapshot.forEach(docItem => {

    const data = docItem.data();

    dataList.push({ id: docItem.id, ...data });

  });



  // Urutkan produk berdasarkan nama secara alfabet

  dataList.sort((a, b) => a.nama.localeCompare(b.nama));



  const wrapper = document.getElementById("produk-grid-wrapper");

  wrapper.innerHTML = "";



  const groupSize = 12;    // Maksimal produk per tabel

  const maxPerRow = 4;     // Maksimal tabel per baris

  const tables = [];



  for (let i = 0; i < dataList.length; i += groupSize) {

    const group = dataList.slice(i, i + groupSize);

    const rows = group.map(p => `
  <tr>
    <td>${p.nama}</td>
    <td>${p.kategori || '-'}</td>
    <td>${p.harga}B</td>
    <td>${p.stok}</td>
    <td>
      <button onclick="ubahStok('${p.id}', ${p.stok + 1})">+</button>
      <button onclick="ubahStok('${p.id}', ${p.stok - 1})">‚àí</button>
      <button onclick="hapusProduk('${p.id}')">‚ùå</button>
    </td>
  </tr>
`).join("");




    const tableHTML = `

      <div class="produk-tabel-wrap">

        <table>

          <thead>

<tr><th>Nama</th><th>Kategori</th><th>Harga</th><th>Stok</th><th>Aksi</th></tr>

          </thead>

          <tbody>${rows}</tbody>

        </table>

      </div>

    `;



    tables.push(tableHTML);

  }



wrapper.innerHTML = `<div class="produk-row">${tables.join('')}</div>`;

} 



// Fungsi untuk mengubah stok produk

window.ubahStok = async function (id, stokBaru) {

  if (stokBaru < 0) return; // Hindari stok negatif

  try {

    await updateDoc(doc(db, "produk", id), { stok: stokBaru });

    await loadProduk(); // Refresh tampilan setelah update

  } catch (error) {

    alert("Gagal mengubah stok: " + error.message);

  }

};



// Fungsi untuk menghapus produk

window.hapusProduk = async function (id) {

  try {

    await deleteDoc(doc(db, "produk", id));

    await loadProduk(); // Refresh tampilan setelah hapus

  } catch (error) {

    alert("Gagal menghapus produk: " + error.message);

  }

};

// Setelah fungsi hapusProduk (atau fungsi lainnya)



window.tambahProduk = async function() {
  const nama = document.getElementById('nama').value.trim();
  const kategori = document.getElementById('kategori').value;
  const harga = Number(document.getElementById('harga').value);
  const stok = Number(document.getElementById('stok').value);

  if (!nama || !kategori || harga <= 0 || stok < 0) {
    alert('Isi semua data dengan benar!');
    return;
  }

  try {
    await addDoc(collection(db, 'produk'), { nama, kategori, harga, stok });
    loadProduk();

    document.getElementById('nama').value = '';
    document.getElementById('kategori').value = ''; // << INI YANG PERLU DITAMBAH
    document.getElementById('harga').value = '';
    document.getElementById('stok').value = '';
  } catch (error) {
    alert('Gagal tambah produk: ' + error.message);
  }
};




// ------------------ PESANAN ----------------------

async function loadPesanan() {

  const tbody = document.getElementById("tabel-pesanan");

  tbody.innerHTML = "<tr><td colspan='6'>‚è≥ Mengambil data...</td></tr>";



  // Ambil semua produk & stok

  const produkSnapshot = await getDocs(collection(db, "produk"));

  const stokMap = {};

  produkSnapshot.forEach(doc => {

    const data = doc.data();

    stokMap[data.nama] = data.stok;

  });



  try {

    const snapshot = await getDocs(collection(db, "pesanan"));

    tbody.innerHTML = "";



    snapshot.forEach(docItem => {

      const data = docItem.data();

      const waktu = data.waktu?.toDate?.()

        ? data.waktu.toDate().toLocaleString()

        : (typeof data.waktu === "string" ? data.waktu : new Date().toLocaleString());



      // Kelola item pesanan

      const itemsList = Array.isArray(data.items) ? data.items : [];

      const itemMap = {};

      itemsList.forEach(item => {

        const key = `${item.nama}___${item.kategori}`;

        itemMap[key] = (itemMap[key] || 0) + 1;

      });



      const itemText = Object.entries(itemMap).map(([key, jumlah], index) => {

        const [nama, kategori] = key.split("___");

        const stok = stokMap[nama] ?? 0;

        const status = stok >= jumlah ? "Ready" : "PO";

        const statusColor = stok >= jumlah ? "lightgreen" : "orange";

        return `${index + 1}. ${nama} (${kategori}) x${jumlah} <small style="color:${statusColor};">(${status})</small>`;

      }).join("<br>");



      // Buat elemen baris tabel

      // Ambil semua kategori dari item pesanan
const kategoriSet = new Set(itemsList.map(item => item.kategori));
const kategoriGabung = [...kategoriSet]
  .map(k => `<span style="background:#333;padding:3px 6px;border-radius:6px;margin:1px;display:inline-block;">${k}</span>`)
  .join(" ");


// Buat elemen baris tabel
const tr = document.createElement("tr");
tr.innerHTML = `
  <td><strong>${data.kode || "‚ùå"}</strong></td>
  <td>${waktu}</td>
  <td>${itemText}</td>
  <td>${kategoriGabung}</td>
  <td style="text-align:center;">
    <input type="checkbox" onchange="toggleStatus('${docItem.id}', this)" ${data.status === 'Diproses' ? 'checked' : ''}>
  </td>
  <td><span id="status-${docItem.id}">${data.status === 'Diproses' ? "Sudah Diproses" : "Menunggu"}</span></td>
  <td>
    <button onclick="hapusPesanan('${docItem.id}')">üóë</button>
    <button onclick="cetakPesanan('${docItem.id}')">üñ®</button>
  </td>
`;


      // Tambahkan highlight jika statusnya Diproses

      if (data.status === 'Diproses') {

        tr.style.backgroundColor = '#1b2d1b';

        tr.style.borderLeft = '4px solid limegreen';

      }



      tbody.appendChild(tr);

    });



    if (!tbody.innerHTML.trim()) {

      tbody.innerHTML = "<tr><td colspan='6'>üì≠ Belum ada pesanan.</td></tr>";

    }



  } catch (err) {

    console.error("‚ùå Gagal mengambil pesanan:", err);

    tbody.innerHTML = "<tr><td colspan='6' style='color:red;'>‚ùå Gagal load pesanan.</td></tr>";

  }

}



// ------------------ TOGGLE STATUS ----------------------

window.toggleStatus = async function (id, checkbox) {

  const newStatus = checkbox.checked ? "Diproses" : "Menunggu";

  await updateDoc(doc(db, "pesanan", id), { status: newStatus });



  const span = document.getElementById(`status-${id}`);

  if (span) span.textContent = newStatus === "Diproses" ? "Sudah Diproses" : "Menunggu";



  // Refresh tampilan highlight tanpa reload

  const tr = checkbox.closest("tr");

  if (newStatus === "Diproses") {

    tr.style.backgroundColor = '#1b2d1b';

    tr.style.borderLeft = '4px solid limegreen';

  } else {

    tr.style.backgroundColor = '';

    tr.style.borderLeft = '';

  }

};



// ------------------ HAPUS PESANAN ----------------------

window.hapusPesanan = async function (id) {

  await deleteDoc(doc(db, "pesanan", id));

  loadPesanan();

};



// ------------------ CETAK PESANAN ----------------------

window.cetakPesanan = async function (id) {

  const docRef = doc(db, "pesanan", id);

  const docSnap = await getDoc(docRef);



  if (docSnap.exists()) {

    const data = docSnap.data();



    const waktu = data.waktu?.toDate?.()

      ? data.waktu.toDate().toLocaleString()

      : (typeof data.waktu === "string" ? data.waktu : new Date().toLocaleString());



    const itemsList = Array.isArray(data.items) ? data.items : [];

    const itemMap = {};

    itemsList.forEach(item => {

      const key = `${item.nama}___${item.kategori}`;

      itemMap[key] = (itemMap[key] || 0) + 1;

    });



    // Ambil harga dari produk

    const produkSnapshot = await getDocs(collection(db, "produk"));

    const hargaMap = {};

    produkSnapshot.forEach(doc => {

      const dataProduk = doc.data();

      hargaMap[dataProduk.nama] = dataProduk.harga;

    });



    let totalPembayaran = 0;



    const itemText = Object.entries(itemMap).map(([key, jumlah], index) => {

      const [nama, kategori] = key.split("___");

      const harga = hargaMap[nama] || 0;

      const subtotal = harga * jumlah;

      totalPembayaran += subtotal;



      return `${index + 1}. ${nama} (${kategori}) x${jumlah} = <strong>${subtotal}B</strong>`;

    }).join("<br>");



    const cetakWindow = window.open('', '', 'width=600,height=400');

    cetakWindow.document.write(`

      <html>

        <head>

          <title>Bukti Pesanan</title>

          <style>

            body { font-family: Arial; padding: 20px; }

            h2 { color: #333; }

            .box { border: 1px solid #ccc; padding: 20px; }

            small { color: #888; }

          </style>

        </head>

        <body>

          <h2>Bukti Pesanan</h2>

          <div class="box">

            <p><strong>Kode:</strong> ${data.kode || "-"}</p>

            <p><strong>Waktu:</strong> ${waktu}</p>

            <p><strong>Items:</strong><br>${itemText}</p>

            <p><strong>Status:</strong> ${data.status || "Menunggu"}</p>

            <p><strong>Total Pembayaran:</strong> ${totalPembayaran}B</p>

          </div>

          <br>

          <button onclick="window.print()">üñ® Cetak</button>

        </body>

      </html>

    `);

    cetakWindow.document.close();

  } else {

    alert("‚ùå Pesanan tidak ditemukan.");

  }

};


  // üîç Filter Produk berdasarkan input pencarian


window.filterProduk = function () {


  const keyword = document.getElementById('cari-produk').value.toLowerCase();


  const allTables = document.querySelectorAll('.produk-tabel-wrap');





  allTables.forEach(tabel => {


    const rows = tabel.querySelectorAll('tbody tr');


    let matchFound = false;





    rows.forEach(row => {


      const namaProduk = row.children[0]?.textContent.toLowerCase() || "";


      const cocok = namaProduk.includes(keyword);


      row.style.display = cocok ? '' : 'none';


      if (cocok) matchFound = true;


    });





    // Sembunyikan tabel jika semua baris di dalamnya disembunyikan


    tabel.style.display = matchFound ? '' : 'none';


  });


};



window.auth = auth;
</script>



  </body>

  </html>
